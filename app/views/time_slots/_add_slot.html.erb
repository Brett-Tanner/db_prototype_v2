<%# TODO: If slot is not registered for, hide the options and they're all set to unregistered. Otherwise you will have to do the current check for each %>

<div class="time_slot">
            <p class="date"><%= add_slot.date %></p>
            <div class="morning">
                <% registered = registrations.any? { |reg| reg.child_id == child.id && reg.registerable_id == add_slot.id } %>

                <%= link_to image_tag(url_for(add_slot.image)), time_slot_path(add_slot) %>
                <div class="add_reg" 
                     data-controller="register"
                     data-register-id-value=<%= add_slot.id %>
                     data-register-type-value="TimeSlot"
                     data-register-child-value=<%= child.id %>>
                    <h4 data-register-target="name"><%= add_slot.name %></h4>
                    <button class="button <%= 'registered' if registered %>" 
                        data-register-target="button" data-action="click->register#toggle"><%= 
                        if registered
                            t('unregister')
                        else
                            t('register')
                        end
                        %></button>
                </div>
                <% add_slot.options.each do |opt| %>
                    <% opt_registered = registrations.any? { |reg| reg.child_id == child.id && reg.registerable_id == opt.id } %>

                    <div class="add_reg" 
                         data-controller="register"
                         data-register-id-value=<%= opt.id %>
                         data-register-type-value="Option"
                         data-register-child-value=<%= child.id %>
                         data-register-cost-value=<%= opt.cost %>>
                        <p data-register-target="name"><%= opt.name %></p>
                        <button class="button <%= 'registered' if opt_registered %>" 
                            data-register-target="button" data-action="click->register#toggle"><%= 
                        if opt_registered
                            '✓'
                        else
                            '✖'
                        end
                        %></button>               
                    </div>
                <% end %>
            </div>
            <div class="afternoon">
                <% afternoon_slot = add_slot.afternoon_slot %>

                <% unless afternoon_slot.nil? %>
                    <% aft_registered = registrations.any? { |reg| reg.child_id == child.id && reg.registerable_id == afternoon_slot.id } %>

                    <div class="add_reg" 
                         data-controller="register"
                         data-register-id-value=<%= afternoon_slot.id %>
                         data-register-type-value="TimeSlot"
                         data-register-child-value=<%= child.id %>>

                        <h4 data-register-target="name"><%= t('.afternoon') %></h4>

                        <button 
                            class="button <%= 'registered' if aft_registered %>" data-register-target="button" data-action="click->register#toggle"><%= 
                            if aft_registered
                                t('unregister')
                            else
                                t('register')
                            end
                            %></button>
                    </div>
                    <% afternoon_slot.options.each do |opt| %>
                        <% opt_registered = registrations.any? { |reg| reg.child_id == child.id && reg.registerable_id == opt.id } %>

                        <div class="add_reg"
                             data-controller="register"
                             data-register-id-value=<%= opt.id %>
                             data-register-type-value="Option"
                             data-register-child-value=<%= child.id %>
                             data-register-cost-value=<%= opt.cost %>>
                            <p data-register-target="name"><%= opt.name %></p>                            
                            <button class="button <%= 'registered' if opt_registered %>" data-register-target="button" data-action="click->register#toggle"><%= 
                            if opt_registered
                                '✓'
                            else
                                '✖'
                            end
                            %></button>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>