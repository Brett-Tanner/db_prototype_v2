<main id="event_children_index" data-controller="refresh">
    <div class="accordion w-100" id="accordionAttendance">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                  <%= t('.daily_attendance') %>
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionAttendance">
                <div class="slots p-3 d-flex flex-wrap gap-3 justify-content-between">
                    <%= link_to t('.all'), children_path(id: @source.id, source: 'Event', all: true), class: 'btn btn-primary' %>
                    <% @source.time_slots.morning.each do |slot| %>
                        <%= link_to slot.name, children_path(id: slot.id, source: 'TimeSlot'), class: 'btn btn-primary' %>
                    <% end %>
                </div>
            </div>
        </div>
    </div>

    <h1><%= @source.name %></h1>
    <h2 class="counter"><span data-refresh-target="counter">10:00</span>後にページが更新される。</h2>
    
    <table class="table table-sm table-light table-striped table-hover table-bordered text-center text-nowrap align-middle">
        <%# Minus 1 for special day %>
        <% cols = @source.time_slots.morning.size - 1 %>
        <% special = @source.time_slots.select { |slot| slot.special? } %>
        
        <thead class="sticky-top">
            <tr class="table-primary">
                <th scope="col" rowspan="2" class="order"></th>
                <th scope="col" rowspan="2" class="name">Name (日本語)</th>
                <th scope="col" rowspan="2" class="en-name">Name (英語)</th>
                <th scope="col" rowspan="2" class="ssid">SSID</th>
                <th scope="col" rowspan="2"><%= t('.cost') %></th>
                <th scope="col" rowspan="2"><%= t('.summary') %></th>
                <th scope="col" rowspan="2"><%= t('.changes') %></th>
                <th scope="col" rowspan="2"><%= t('.coupons') %></th>
                <th scope="col" rowspan="2"><%= t('.billing_date') %></th>
                <th scope="col" rowspan="2"><%= t('.email_template') %></th>
                <th scope="col" rowspan="2"><%= t('.reg_days') %></th>
                <th scope="col" rowspan="2"><%= t('.allergy') %></th>
                <th scope="col" rowspan="2"><%= t('.photo') %></th>
                <% unless special.size.zero? %>
                    <th scope="col" colspan="3"><%= "スペシャルデー #{special.first.start_time.strftime('%m月%d日')}" %></th>
                <% end %>
                <% cols.times do |i| %>
                    <th scope="col" colspan="3"><%= "Day #{i + 1}" %></th>
                <% end %>
            </tr>
            <tr class="table-primary">
                <% unless special.size.zero? %>
                    <th scope="col">午前 / 午後</th>
                    <th scope="col">昼食</th>
                    <th scope="col">延長(前) / 中延長 / 延長(後)</th>
                <% end %>
                <% cols.times do |i| %>
                    <th scope="col">午前 / 午後</th>
                    <th scope="col">昼食 / 夕食</th>
                    <th scope="col">延長(前) / 延長(後)</th>
                <% end %>
            </tr>
        </thead>

        <%= render partial: 'children/event_child', collection: @children, locals: { cols: cols, event: @source } %>
    </table>
</main>