<main id="invoice_confirm">
    <% if @invoice %>
        <%= link_to t('back'), :back, class: 'btn btn-primary align-self-start' %>

        <h1 class="text-center"><%= t('.please_confirm') %></h1>

        <%= render @invoice, index: false %>

        <%= form_for @invoice, url: invoice_path(@invoice), method: :patch, html: { class: 'd-grid p-2' } do |f| %>
            <%= f.hidden_field :id %>
            <%= f.hidden_field :child_id %>
            <%= f.hidden_field :event_id %>

            <div class="slot_regs">
                <%= f.fields_for :slot_regs do |slot_f| %>
                    <div>
                        <%= slot_f.hidden_field :_destroy %>
                        <%= slot_f.hidden_field :id %>
                        <%= slot_f.hidden_field :child_id %>
                        <%= slot_f.hidden_field :registerable_id %>
                        <%= slot_f.hidden_field :registerable_type %>
                    </div>
                <% end %>
            </div>

            <div class="opt_regs">
                <%= f.fields_for :opt_regs do |opt_f| %>
                    <div>
                        <%= opt_f.hidden_field :_destroy %>
                        <%= opt_f.hidden_field :id %>
                        <%= opt_f.hidden_field :child_id %>
                        <%= opt_f.hidden_field :registerable_id %>
                        <%= opt_f.hidden_field :registerable_type %>
                    </div>
                <% end %>
            </div>

            <button class="btn btn-info mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#coupons" aria-expanded="false" aria-controls="coupons">
                <%= t('.apply_coupon') %>
            </button>
            <div class="collapse mb-3" id="coupons">
                <%= f.fields_for :coupons, f.object.coupons.new do |coup_f| %>
                    <div class="d-flex flex-column justify-content-around align-items-center gap-3">
                        <%= coup_f.label :code, t('.coupon'), class: 'form-label text-center' %>
                        <%= coup_f.select :code, [['', nil], %w[WELBOX WELBOX], %w[すくすくえいど すくすくえいど]], {}, class: 'form-select' %>
                    </div>
                <% end %>
            </div>

            <%= f.submit t('.confirm_changes'), class: 'btn btn-primary' %>
        <% end %>

        <% unless @ss_invoices.empty? %>
            <h1><%= t('.confirmed') %></h1>

            <%= render partial: 'invoices/invoice', collection: @ss_invoices, locals: { index: false } %>
        <% end %>
    <% else %>
        <h1><%= t('.already_confirmed') %></h1>
    <% end %>
</main>