<% child_invoices = @invoice.child.invoices.where(event_id: @invoice.event_id) %>

<% if @invoice.seen_at.present? && @invoice.seen_at > @invoice.updated_at %>
    <%= turbo_stream.replace "child#{@invoice.child_id}changes" do %>
        <td rowspan="2"></td>
    <% end %>
<% end %>

<%= turbo_stream.replace "child#{@invoice.child_id}entered" do %>
   <td rowspan="2" id=<%= "child#{@invoice.child_id}entered" %>>
        <% if child_invoices.size == 1 %>
            <% i = child_invoices.first %>
            <% if i.entered %>
                <%= form_with model: i do |f| %>
                    <%= f.hidden_field :entered, value: false %>
                    <%= f.submit '✔', class: 'form-check-input w-50 h-50 rounded entered text-center' %>
                <% end %>
            <% else %>
                <%= form_with model: i do |f| %>
                    <%= f.hidden_field :entered, value: true %>
                    <%= f.hidden_field :in_ss, value: true %>
                    <%= f.submit '', class: 'form-check-input rounded w-50 h-50 not-entered' %>
                <% end %>
            <% end %>
        <% else %>
            <% child_invoices.select { |i| i.total_cost > 3_000 }.each do |i| %>
                <% if i.entered %>
                    <%= form_with model: i, class: 'd-flex d-column justify-content-center align-items-center gap-1' do |f| %>
                        <%= f.hidden_field :entered, value: false %>
                        <div class="d-flex gap-1">
                            <%= number_to_currency(i.total_cost, unit: '円', precision: 0, locale: :ja) %>
                            <%= f.submit '', class: 'form-check-input rounded entered text-center' %>
                        </div>
                    <% end %>
                <% else %>
                    <%= form_with model: i, class: 'd-flex d-column justify-content-center align-items-center gap-1' do |f| %>
                        <%= f.hidden_field :entered, value: true %>
                        <%= f.hidden_field :in_ss, value: true %>
                        <div class="d-flex gap-1">
                            <%= number_to_currency(i.total_cost, unit: '円', precision: 0, locale: :ja) %>
                            <%= f.submit '', class: 'form-check-input rounded not-entered' %>
                        </div>
                    <% end %>
                <% end %>
            <% end %>
        <% end %>
   </td>
<% end %>

<%= turbo_stream.replace "child#{@invoice.child_id}invoices" do %>
    <td rowspan="2" class="invoices" id=<%= "child#{@invoice.child_id}invoices" %>>
        <% child_invoices.select { |i| i.total_cost > 3_000}.each do |invoice| %>
            <% if invoice.in_ss %>
                <p><%= link_to number_to_currency(invoice.total_cost, unit: '円', precision: 0, locale: :ja), invoice_path(invoice), class: 'text-info' %></p>
            <% else %>
                <p><%= link_to number_to_currency(invoice.total_cost, unit: '円', precision: 0, locale: :ja), invoice_path(invoice), class: 'text-danger fw-bold' %></p>
            <% end %>
        <% end %>
    </td>
<% end %>